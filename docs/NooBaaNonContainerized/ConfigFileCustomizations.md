# NooBaa Non Containerized - Config.json File Customization 


1. [Introduction](#introduction)
2. [Customization Options List](#customization-options-list)
3. [Config.json File Examples](#configjson-file-examples)

## Introduction
A user can customize NooBaa Non Containerized by creation of config.json file under their config directory.
config.json contains -
1. Shared configuration - Global customizations shared by all nodes.
2. Host customization - Host specific customizations.

When a node is assigned in the host_customization, NooBaa will combine the shared configuration with the node's configuration. If a configuration value is provided under the node's configuration, it will take precedence as the final configuration value applied to NooBaa service on that specific node.

## Customization Options List
The following list consists of supported optional developer customization -

### 1. Number of forks - 
* <u>Key</u>: `ENDPOINT_FORKS`  
* <u>Type</u>: Number  
* <u>Default</u>: 0  
* <u>Description</u>: Adjust the number of forks in order to increase the S3 endpoints number. This will enable NooBaa to handle a higher scale of S3 requests concurrently.  
* <u>Steps</u>:  
    ```
    1. Open /path/to/config_dir/config.json file.
    2. Set the ENDPOINT_FORKS key to the desired level.
    Example:
    "ENDPOINT_FORKS":8
    3. systemctl restart noobaa
    ```

### 2. Debug log level -
* <u>Key</u>: `NOOBAA_LOG_LEVEL`  
* <u>Type</u>: String  
* <u>Default</u>: "default"  
* <u>Description</u>: Set the debug level to control the amount of debugging information generated by the application.  
    Supported log levels -
    1. default - for default debugging
    2. warn - for only warning/errors debugging. 
    3. nsfs - for more nsfs detailed debugging.
    4. all - for all detailed debugging.  
* <u>Steps</u>:  
    ```
    1. Open /path/to/config_dir/config.json file.
    2. Set the NOOBAA_LOG_LEVEL key to the desired level.
    Example:
    "NOOBAA_LOG_LEVEL": "nsfs"
    3. systemctl restart noobaa
    ```

### 3. Ports -
* <u>Keys</u>: `ENDPOINT_PORT`, `ENDPOINT_SSL_PORT`, `ENDPOINT_SSL_STS_PORT`, `EP_METRICS_SERVER_PORT`  
* <u>Type</u>: Number  
* <u>Default</u>: ENDPOINT_PORT=6001, ENDPOINT_SSL_PORT=6443, ENDPOINT_SSL_STS_PORT=7443, EP_METRICS_SERVER_PORT=7004  
* <u>Description</u>: Adjust the ports used by the application for communication
    The following S3 endpoint ports can be customized -
    1. `ENDPOINT_PORT` - S3 HTTP port 
    2. `ENDPOINT_SSL_PORT` - S3 HTTPS port 
    3. `ENDPOINT_SSL_STS_PORT` - STS HTTPS port 
    4. `EP_METRICS_SERVER_PORT` - Prometheus metrics port  
* <u>Steps</u>:  
    ```
    1. Open /path/to/config_dir/config.json file.
    2. Set the config key -
    Example:
    "ENDPOINT_PORT": 5555
    3. systemctl restart noobaa
    ```

### 4. Allow HTTP requests-
* <u>Key</u>: `ALLOW_HTTP`  
* <u>Type</u>: Boolean  
* <u>Default</u>: false  
* <u>Description</u>: Enable or disable listening to HTTP requests.  
* <u>Steps</u>:  
    ```
    1. Open /path/to/config_dir/config.json file.
    2. Set the config key -
    Example:
    "ALLOW_HTTP": true
    3. systemctl restart noobaa
    ```

### 5. MD5 calculation -
* <u>Key</u>: `NSFS_CALCULATE_MD5`  
* <u>Type</u>: Boolean   
* <u>Default</u>: false  
* <u>Description</u>: Enable or disable MD5 calculation on PUT object or Multipart upload requests.  
* <u>Steps</u>:  
    ```
    1. Open /path/to/config_dir/config.json file.
    2. Set the config key -
    Example:
    "NSFS_CALCULATE_MD5": true
    ```

### 6. UV_THREADPOOL_SIZE -
* <u>Key</u>: `UV_THREADPOOL_SIZE`  
* <u>Type</u>: Number  
* <u>Default</u>: 4  
* <u>Description</u>: Set `UV_THREADPOOL_SIZE` in order to increase the number of libuv threads (These threads used for running all file system operations) and results with increase of NooBaa's performance - https://docs.libuv.org/en/v1.x/threadpool.html.  
* <u>Steps</u>:  
    ```
    1. Open /path/to/config_dir/config.json file.
    2. Set the config key -
    Example:
    "UV_THREADPOOL_SIZE": 8
    3. systemctl restart noobaa
    ```

### 7. GPFS library path -
* <u>Key</u>: `GPFS_DL_PATH`  
* <u>Type</u>: String  
* <u>Default</u>: ''   
* <u>Description</u>: Set GPFS library path location.  
* <u>Steps</u>:  
    ```
    1. Open /path/to/config_dir/config.json file.
    2. Set the config key -
    Example:
    "GPFS_DL_PATH": "/usr/lib64/libgpfs.so"
    3. systemctl restart noobaa
    ```

### 8. Buffer pool memory limit -
* <u>Key</u>: `NSFS_BUF_POOL_MEM_LIMIT`  
* <u>Type</u>: Number  
* <u>Default</u>: 33554432 bytes = 32MB = 32 * 1024 * 1024  
* <u>Description</u>: Set Buffer pool memory limit (bytes) in order to increase performance. Suggested values 1-4GB, service restart required.  
* <u>Steps</u>:  
    ```
    1. Open /path/to/config_dir/config.json file.
    2. Set the config key in bytes-
    Example: 
    "NSFS_BUF_POOL_MEM_LIMIT" : 52428800
    3. systemctl restart noobaa
    ```

### 9. Open read mode -
* <u>Key</u>: `NSFS_OPEN_READ_MODE`  
* <u>Type</u>: String   
* <u>Default</u>: 'r'   
* <u>Description</u>: Set the mode of open for read, use 'rd' for direct-io reads.  
* <u>Steps</u>:  
    ```
    1. Open /path/to/config_dir/config.json file.
    2. Set the config key -
    Example:
    "NSFS_OPEN_READ_MODE": "rd"
    ```

### 10. Trigger Check bucket boundaries -
* <u>Key</u>: `NSFS_CHECK_BUCKET_BOUNDARIES`    
* <u>Type</u>: Boolean   
* <u>Default</u>: true  
* <u>Description</u>: Enable/Disable bucket boundaries checks.  
* <u>Steps</u>:  
    ```
    1. Open /path/to/config_dir/config.json file.
    2. Set the config key -
    Example:
    "NSFS_CHECK_BUCKET_BOUNDARIES": false
    ```

### 11. Trigger Fsync -
* <u>Key</u>: `NSFS_TRIGGER_FSYNC`  
* <u>Type</u>: Boolean   
* <u>Default</u>: true    
* <u>Description</u>: Enable/Disable fsync triggers, changing value to false is unsafe for production envs.  
* <u>Steps</u>:  
    ```
    1. Open /path/to/config_dir/config.json file.
    2. Set the config key -
    Example:
    "NSFS_TRIGGER_FSYNC": false
    ```

### 12. Whitelist IPs -
* <u>Key</u>: `S3_SERVER_IP_WHITELIST`  
* <u>Type</u>:* Array  
* <u>Default</u>: false  
* <u>Description</u>: List of whitelist IPs. Access is restricted to these server IPs only. If there are no IPs mentioned all IPs are allowed.  
* s<u>Steps</u>:  
    ```
    1. run CLI command
    sudo noobaa-cli whitelist --ips '["127.0.0.1", "192.000.10.000", "3002:0bd6:0000:0000:0000:ee00:0033:000"]'  2>/dev/null
    ```

### 13. Config directory backend -
* <u>Key</u>: `NSFS_NC_CONFIG_DIR_BACKEND`  
* <u>Type</u>: String  
* <u>Default</u>: ''  
* <u>Description</u>: Set custom file system backend type of the config directory. Set to GPFS in order to increase performance of creation/deletion of config files under the config directory.  
* <u>Steps</u>:  
    ```
    1. Open /path/to/config_dir/config.json file.
    2. Set the config key -
    Example:
    "NSFS_NC_CONFIG_DIR_BACKEND": "GPFS"
    ```

### 14. Storage Backend -
* <u>Key</u>: `NSFS_NC_STORAGE_BACKEND`  
* <u>Type</u>: String  
* <u>Default</u>: ''  
* <u>Description</u>: Set custom file system backend type of the storage file system. Set to GPFS in order to increase performance of creation/deletion of objects stored in the underlying file system.  
* <u>Steps</u>:  
    ```
    1. Open /path/to/config_dir/config.json file.
    2. Set the config key -
    Example:
    "NSFS_NC_STORAGE_BACKEND": "GPFS"
    3. systemctl restart noobaa
    ```

### 15. Directories cache max directory size -
* <u>Key</u>: `NSFS_DIR_CACHE_MAX_DIR_SIZE`  
* <u>Type</u>: Number  
* <u>Default</u>: 67108864 // 64MB = 64 * 1024 * 1024  
* <u>Description</u>: Establish a custom maximum directory size configuration to enhance the performance of listing objects, particularly in scenarios where a bucket comprises a substantial number of directories.  
* <u>Steps</u>:  
    ```
    1. Open /path/to/config_dir/config.json file.
    2. Set the config key -
    Example:
    "NSFS_DIR_CACHE_MAX_DIR_SIZE": 268435456
    3. systemctl restart noobaa
    ```

### 16. Directories cache max total usage size -
* <u>Key</u>: `NSFS_DIR_CACHE_MAX_TOTAL_SIZE`  
* <u>Type</u>: Number  
* <u>Default</u>: 268435456 // 256MB = 4 * config.NSFS_DIR_CACHE_MAX_DIR_SIZE = 4 * 1024 * 1024  
* <u>Description</u>: Establish a custom maximum total cache usage size configuration to enhance the performance of listing objects, particularly in scenarios where a bucket comprises a substantial number of directories.  
* <u>Steps</u>:  
    ```
    1. Open /path/to/config_dir/config.json file.
    2. Set the config key -
    Example:
    "NSFS_DIR_CACHE_MAX_TOTAL_SIZE": 805306368
    3. systemctl restart noobaa
    ```


### 17. Disable random seeding -
* <u>Key</u>: `ENABLE_DEV_RANDOM_SEED`  
* <u>Type</u>: Boolean  
* <u>Default</u>: false  
* <u>Description</u>: This flag will enable the random seeding for the application.  
* <u>Steps</u>:  
    ```
    1. Open /path/to/config_dir/config.json file.
    2. Set the config key -
    Example:
    "ENABLE_DEV_RANDOM_SEED": false
    3. systemctl restart noobaa
    ```

### 18. Set Master Keys Store type-
* <u>Key</u>: `NC_MASTER_KEYS_STORE_TYPE`  
* <u>Type</u>: String  
* <u>Default</u>: 'file'  
* <u>Description</u>: This flag will set the type of the master keys store used by NooBaa.  
* <u>Steps</u>:  
    ```
    1. Open /path/to/config_dir/config.json file.
    2. Set the config key -
    Example:
    "NC_MASTER_KEYS_STORE_TYPE": 'executable'
    3. systemctl restart noobaa
    ```

### 19. Set Master Keys File Location -
* <u>Key</u>: `NC_MASTER_KEYS_FILE_LOCATION`    
* <u>Type</u>: String  
* <u>Default</u>: '/etc/noobaa.conf.d/master_keys.json'  
* <u>Description</u>: This flag will set the location of the master keys file used by NooBaa.  
* <u>Steps</u>:  
    ```
    1. Open /path/to/config_dir/config.json file.
    2. Set the config key -
    Example:
    "NC_MASTER_KEYS_FILE_LOCATION": '/private/tmp/master_keys.json'
    3. systemctl restart noobaa
    ```

### 20. Set Master Keys GET executable script -
* <u>Key</u>: `NC_MASTER_KEYS_GET_EXECUTABLE`  
* <u>Type</u>: String  
* <u>Default</u>: undefined  
* <u>Description</u>: This flag will set the location of the executable script for reading the master keys file used by NooBa.  
* <u>Steps</u>:  
    ```
    1. Open /path/to/config_dir/config.json file.
    2. Set the config key -
    Example:
    "NC_MASTER_KEYS_GET_EXECUTABLE": '/private/tmp/get_master_keys.sh'
    3. systemctl restart noobaa
    ```

### 21. Set Master Keys PUT executable script -
* <u>Key</u>: `NC_MASTER_KEYS_PUT_EXECUTABLE`  
* <u>Type</u>: String  
* <u>Default</u>: undefined  
* <u>Description</u>: This flag will set the location of the executable script for updating the master keys file used by NooBa.  
* <u>Steps</u>:  
    ```
    1. Open /path/to/config_dir/config.json file.
    2. Set the config key -
    Example:
    "NC_MASTER_KEYS_PUT_EXECUTABLE": '/private/tmp/put_master_keys.sh'
    3. systemctl restart noobaa
    ```

### 22. Set Virtual hosts -
* <u>Key</u>: `VIRTUAL_HOSTS`   
* <u>Type</u>: String  
* <u>Default</u>: ''  
* <u>Description</u>: This flag will set the virtual hosts used by NooBaa, service restart required. Set the virtual hosts as string of domains seperated by spaces.  
* <u>Steps</u>:  
    ```
    1. Open /path/to/config_dir/config.json file.
    2. Set the config key -
    Example:
    "VIRTUAL_HOSTS": 'my.vritual.host.io'
    3. systemctl restart noobaa_nsfs
    ```

### 23. Disable schema check -
* <u>Key</u>: `NC_DISABLE_SCHEMA_CHECK`  
* <u>Type</u>: Boolean  
* <u>Default</u>: false  
* <u>Description</u>: This flag will disable all schema validations of the config files - configuration, accounts and buckets.   
Warning: After setting this configuration, NooBaa will skip schema validations and one can create invalid accounts/buckets entities or apply invalid configuration which may cause an unexpected behavior.    
* <u>Steps</u>:  
    ```
    1. Open /path/to/config_dir/config.json file.
    2. Set the config key -
    Example:
    "NC_DISABLE_SCHEMA_CHECK": true
    ```


### 24. Disable Read accessibility check -
* <u>Key</u>: `NC_DISABLE_ACCESS_CHECK`  
* <u>Type</u>: Boolean  
* <u>Default</u>: false  
* <u>Description</u>: Setting this flag to true will disable Read accessibility validations in the following flows -  
    1. Bucket creation/update - NooBaa will not validate that the bucket owner has read permissions to the bucket's path.  
    2. Account creation/update - NooBaa will not validate that the account owner has read permissions to the account's new_buckets_path.  
    3. Health buckets and accounts accessibility check.
    Warning - setting this configuration to true might result with unexpected behavior. 

* <u>Steps</u>:  
    ```
    1. Open /path/to/config_dir/config.json file.
    2. Set the config key -
    Example:
    "NC_DISABLE_ACCESS_CHECK": true
    ```

### 25. Disable Read accessibility check on the Health CLI -
* <u>Key</u>: `NC_DISABLE_HEALTH_ACCESS_CHECK`  
* <u>Type</u>: Boolean  
* <u>Default</u>: false  
* <u>Description</u>: This flag will disable Read accessibility validations in Health check of buckets and accounts.

* <u>Steps</u>:  
    ```
    1. Open /path/to/config_dir/config.json file.
    2. Set the config key -
    Example:
    "NC_DISABLE_HEALTH_ACCESS_CHECK": true
    ```

### 26. Disable Read/Write POSIX mode bits check -
* <u>Key</u>: `NC_DISABLE_POSIX_MODE_ACCESS_CHECK`  
* <u>Type</u>: Boolean  
* <u>Default</u>: true  
* <u>Description</u>: Setting this flag to false will enable Read/Write mode bits accessibility validations by in the following flows -  
    1. Bucket creation/update - NooBaa will validate that the bucket owner has read/write permissions to the bucket's path.  
    2. Account creation/update - NooBaa will validate that the account owner has read/write permissions to the account's new_buckets_path.  
    3. Health buckets and accounts accessibility check.
    Warning - This configuration is disabled by default because it's not supporting ACLs, setting this configuration to false won't support a check of the ACLs and be based only on mode bits check.

* <u>Steps</u>:  
    ```
    1. Open /path/to/config_dir/config.json file.
    2. Set the config key -
    Example:
    "NC_DISABLE_POSIX_MODE_ACCESS_CHECK": false
    ```


### 27. Set Endpoint process title -
* <u>Key</u>: `ENDPOINT_PROCESS_TITLE`  
* <u>Type</u>: String  
* <u>Default</u>: 'noobaa'  
* <u>Description</u>: This flag will set NooBaa process title for letting GPFS to identify the NooBaa endpoint processes. See issue [#8039](https://github.com/noobaa/noobaa-core/issues/8039).   
* <u>Steps</u>:  
    ```
    1. Open /path/to/config_dir/config.json file.
    2. Set the config key -
    Example:
    "ENDPOINT_PROCESS_TITLE": 'noobaa_60'
    3. systemctl restart noobaa_nsfs
    ## Config.json example 
    ```

### 28. GPFS down delay -
* <u>Key</u>: `GPFS_DOWN_DELAY`  
* <u>Type</u>: Number  
* <u>Default</u>: 1000  
* <u>Description</u> Set delay (ms) of GPFS system calls when daemon is down, to hold client replies during failover, service restart required.  
* <u>Steps</u>:  
    ```
    1. Open /path/to/config_dir/config.json file.
    2. Set the config key -
    Example:
    "GPFS_DOWN_DELAY": "60000"
    3. systemctl restart noobaa
    ```

### 29. Syslog enable flag -
* <u>Key</u>: `LOG_TO_SYSLOG_ENABLED`  
* <u>Type</u>: Boolean  
* <u>Default</u>: true  
* <u>Description</u>: This flag will enable syslog logging for the application.  
* <u>Steps</u>:  
    ```
    1. Open /path/to/config_dir/config.json file.
    2. Set the config key -
    Example:
    "LOG_TO_SYSLOG_ENABLED": true
    3. systemctl restart noobaa
    ```

### 30. Stderr enable flag -
* <u>Key</u>: `LOG_TO_STDERR_ENABLED`  
* <u>Type</u>: Boolean  
* <u>Default</u>: false  
* <u>Description</u>: This flag will decide whether logs will be pushed stderr or not.     
* <u>Steps</u>:  
    ```
    1. Open /path/to/config_dir/config.json file.
    2. Set the config key -
    Example:
    "LOG_TO_STDERR_ENABLED": false
    3. systemctl restart noobaa
    ```

## Config.json File Examples
The following is an example of a config.json file - 

```sh
> cat /path/to/config_dir/config.json
{
    "ENDPOINT_PORT": 80,
    "ENDPOINT_SSL_PORT": 443,
    "ENDPOINT_FORKS": 16,
    "UV_THREADPOOL_SIZE": 256,
    "GPFS_DL_PATH": "/usr/lpp/mmfs/lib/libgpfs.so",
    "NSFS_BUF_POOL_MEM_LIMIT": 4294967296,
    "NSFS_OPEN_READ_MODE": "rd",
    "NSFS_CHECK_BUCKET_BOUNDARIES": false,
    "ALLOW_HTTP": true,
    "S3_SERVER_IP_WHITELIST":["127.0.0.1","192.000.10.000","3002:0bd6:0000:0000:0000:ee00:0033:000"]
}

```

The following is an example of a multi-host config.json file - 
```sh
> cat /path/to/config_dir/config.json
{
    "ENDPOINT_FORKS": 2,
    "host_customization": {
        "{node_name}" : {
            "ENDPOINT_FORKS": 3, 
        }
    }
}
```
